<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WebXR AR Object Placement</title>
  <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/aframe-extras@6.1.1/dist/aframe-extras.min.js"></script>
</head>
<body style="margin: 0; overflow: hidden;">

  <button id="startAR" onclick="startAR()" style="position: fixed; top: 10px; left: 50%; transform: translateX(-50%); z-index: 9999; padding: 10px; font-size: 16px;">
    Activar AR
  </button>

  <script>
    function startAR() {
      document.getElementById("startAR").style.display = "none"; // Oculta el bot칩n

      // Crear din치micamente la escena AR
      let scene = document.createElement("a-scene");
      scene.setAttribute("embedded", "");
      scene.setAttribute("xr-mode-ui", "enabled: false");
      scene.setAttribute("renderer", "logarithmicDepthBuffer: true;");

      // Crear la c치mara
      let camera = document.createElement("a-camera");
      camera.setAttribute("position", "0 1.6 0");
      camera.innerHTML = `<a-cursor></a-cursor>`;
      scene.appendChild(camera);

      // Luz direccional
      let light = document.createElement("a-light");
      light.setAttribute("type", "directional");
      light.setAttribute("position", "1 1 1");
      light.setAttribute("intensity", "1");
      scene.appendChild(light);

      // Modelo 3D interactivo
      let object = document.createElement("a-entity");
      object.setAttribute("id", "objectPlaced");
      object.setAttribute("gltf-model", "https://immersive-web.github.io/webxr-samples/media/gltf/sunflower/sunflower.gltf");
      object.setAttribute("position", "0 0 -2");
      object.setAttribute("scale", "0.5 0.5 0.5");
      object.setAttribute("rotation", "0 180 0");
      object.setAttribute("gesture-handler", "");
      scene.appendChild(object);

      // Agregar la escena al body
      document.body.appendChild(scene);
    }

    // Componente para manipular el objeto con gestos
    AFRAME.registerComponent('gesture-handler', {
      init: function () {
        let el = this.el;
        let scale = 1;
        let rotationY = 0;
        let lastTouchDistance = null;

        this.el.sceneEl.addEventListener('touchstart', function (event) {
          if (event.touches.length === 2) {
            lastTouchDistance = getDistance(event.touches[0], event.touches[1]);
          }
        });

        this.el.sceneEl.addEventListener('touchmove', function (event) {
          if (event.touches.length === 1) {
            // Rotaci칩n
            let deltaX = event.touches[0].clientX - window.innerWidth / 2;
            rotationY += deltaX * 0.1;
            el.setAttribute('rotation', `0 ${rotationY} 0`);
          } else if (event.touches.length === 2) {
            // Escalar con dos dedos
            let currentDistance = getDistance(event.touches[0], event.touches[1]);
            if (lastTouchDistance) {
              let scaleChange = currentDistance / lastTouchDistance;
              scale *= scaleChange;
              el.setAttribute('scale', `${scale} ${scale} ${scale}`);
            }
            lastTouchDistance = currentDistance;
          }
        });

        function getDistance(touch1, touch2) {
          let dx = touch1.clientX - touch2.clientX;
          let dy = touch1.clientY - touch2.clientY;
          return Math.sqrt(dx * dx + dy * dy);
        }
      }
    });
  </script>
</body>
</html>
